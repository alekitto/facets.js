{"version":3,"file":"facets-js.js","sources":["../lib/FieldType.ts","../lib/Field.ts","../lib/util.ts","../lib/i18n/en.ts","../lib/filter/Filter.ts","../lib/Facets.ts"],"sourcesContent":["export enum FieldType {\n    TEXT = 'text',\n    BOOLEAN = 'boolean',\n    NUMBER = 'number',\n    DATE = 'date',\n    TIME = 'time',\n    CHOICE = 'choice',\n}\n","import { FieldType } from './FieldType';\n\ninterface BaseFieldProps {\n    name: string;\n    label?: string;\n}\n\nexport interface Choice {\n    label: string;\n    value: string;\n}\n\nexport type Choices = Choice[] | IterableIterator<Choice>;\ntype ChoicesLoader = Choices | (() => IterableIterator<Choices>) | (() => Promise<IterableIterator<Choices>>);\n\nexport type FieldProps = BaseFieldProps & ({\n    type: Exclude<FieldType, FieldType.CHOICE>;\n} | {\n    type: FieldType.CHOICE;\n    choices: ChoicesLoader;\n});\n\nexport class Field {\n    readonly name: string;\n    readonly label: string;\n    readonly type: FieldType;\n    readonly choices: null | ChoicesLoader;\n\n    constructor(props: FieldProps) {\n        this.name = props.name;\n        this.label = props.label ?? props.name;\n        this.type = props.type;\n        this.choices = props.type === FieldType.CHOICE ? props.choices : null;\n    }\n}\n","export const createLink = (className: string, label: string, hidden: boolean): HTMLAnchorElement => {\n    const el = document.createElement('a');\n    el.classList.add(className);\n    if (hidden) {\n        el.style.display = 'none';\n    }\n\n    el.addEventListener('click', e => e.preventDefault());\n    el.innerText = label;\n\n    return el;\n};\n\nexport const createButton = (className: string, label: string, icon?: string): HTMLButtonElement => {\n    const el = document.createElement('button');\n    el.type = 'button';\n\n    el.classList.add(className);\n\n    if (icon) {\n        el.title = label;\n\n        const iconEl = document.createElement('i');\n        iconEl.classList.add('facets-ico-' + icon);\n        el.appendChild(iconEl);\n    } else {\n        el.innerText = label;\n    }\n\n    return el;\n};\n","import { Localization } from './localization';\n\nexport const en: Localization = {\n    'is equal to': 'is equal to',\n    'is not equal to': 'is not equal to',\n    'contains': 'contains',\n    'does not contain': 'does not contain',\n    'starts with': 'starts with',\n    'ends with': 'ends with',\n    'is empty': 'is empty',\n    'is not empty': 'is not empty',\n    'greater than': 'greater than',\n    'greater than or equal': 'greater than or equal',\n    'less than': 'less than',\n    'less than or equal': 'less than or equal',\n    'loading': 'Loading...',\n    'error while loading options': 'Error while loading options',\n    Yes: 'Yes',\n    No: 'No',\n};\n","import { Choice, Choices, Field } from '../Field';\nimport EventTarget from 'event-target-shim';\nimport { FieldType } from '../FieldType';\nimport { FilterInterface } from './FilterInterface';\nimport { Localization } from '../i18n/localization';\nimport { createButton } from '../util';\nimport { en } from '../i18n/en';\n\nconst TEXT_OPERATORS: [string, keyof Localization][] = [\n    [ 'eq', 'is equal to' ],\n    [ 'neq', 'is not equal to' ],\n    [ 'ct', 'contains' ],\n    [ 'nct', 'does not contain' ],\n    [ 'sw', 'starts with' ],\n    [ 'ew', 'ends with' ],\n    [ 'null', 'is empty' ],\n    [ 'notnull', 'is not empty' ],\n];\n\nconst NUMBER_OPERATORS: [string, keyof Localization][] = [\n    [ 'eq', 'is equal to' ],\n    [ 'neq', 'is not equal to' ],\n    [ 'gt', 'greater than' ],\n    [ 'gte', 'greater than or equal' ],\n    [ 'lt', 'less than' ],\n    [ 'lte', 'less than or equal' ],\n    [ 'null', 'is empty' ],\n    [ 'notnull', 'is not empty' ],\n];\n\nexport class Filter extends EventTarget implements FilterInterface {\n    public other?: () => string;\n    readonly container: HTMLElement;\n\n    private readonly hide: () => void;\n    private readonly show: () => void;\n    private _field: Field | null = null;\n    private _operator?: () => [string, string];\n    private specContainer: HTMLDivElement;\n    private label: HTMLSpanElement;\n\n    private fieldSelect: HTMLSelectElement;\n    private operatorSelect: null | HTMLSelectElement = null;\n    private otherInput: null | HTMLInputElement | HTMLSelectElement = null;\n\n    constructor(private fields: Field[] | Readonly<Field[]>, appendChild: (element: HTMLElement) => HTMLElement, private locale: Localization = en, show = true) {\n        super();\n\n        const container = document.createElement('div');\n        container.classList.add('filter-container');\n        container.style.display = 'flex';\n\n        this.container = appendChild(container);\n\n        const fieldSelect = this.fieldSelect = this.container.appendChild(document.createElement('select'));\n        let emptyOption: HTMLOptionElement | null = fieldSelect.appendChild(document.createElement('option'));\n\n        fieldSelect.value = '';\n        for (const field of fields) {\n            const option = document.createElement('option');\n            option.value = field.name;\n            option.innerText = field.label;\n\n            fieldSelect.appendChild(option);\n        }\n\n        this.specContainer = this.container.appendChild(document.createElement('div'));\n        this.specContainer.style.display = 'flex';\n\n        this.label = this.container.appendChild(document.createElement('span'));\n        this.label.classList.add('filter-label');\n        this.label.style.display = 'none';\n\n        const removeFilterBtn = this.container.appendChild(createButton('remove-filter-btn', 'Remove filter', 'minus'));\n        removeFilterBtn.addEventListener('click', () => {\n            const e = new CustomEvent('remove', {\n                detail: {\n                    target: this,\n                },\n            });\n\n            this.dispatchEvent(e);\n        });\n\n        const applyFilterBtn = this.container.appendChild(createButton('apply-filter-btn', 'Apply filter', 'checkmark'));\n        applyFilterBtn.style.display = 'none';\n        applyFilterBtn.addEventListener('click', () => this.applyFilter());\n\n        fieldSelect.addEventListener('change', e => {\n            e.stopPropagation();\n            if (null !== emptyOption) {\n                fieldSelect.removeChild(emptyOption);\n                emptyOption = null;\n            }\n\n            const field = fields.find(f => f.name === (e.target as HTMLSelectElement).value)!;\n            if (! field) {\n                e.preventDefault();\n                return;\n            }\n\n            applyFilterBtn.style.display = 'block';\n            this._field = field;\n            this._initFilter();\n        });\n\n        fieldSelect.focus();\n\n        this.hide = (): void => {\n            fieldSelect.style.display = 'none';\n            this.specContainer.style.display = 'none';\n            applyFilterBtn.style.display = 'none';\n            removeFilterBtn.style.display = 'none';\n\n            this.label.style.display = 'inline-block';\n        };\n\n        this.show = (): void => {\n            const event = new CustomEvent('open', {\n                detail: {\n                    target: this,\n                },\n            });\n\n            this.dispatchEvent(event);\n            if (event.defaultPrevented) {\n                return;\n            }\n\n            fieldSelect.style.display = 'block';\n            this.specContainer.style.display = 'flex';\n            applyFilterBtn.style.display = this._field ? 'block' : 'none';\n            removeFilterBtn.style.display = 'block';\n\n            this.label.style.display = 'none';\n        }\n\n        this.label.addEventListener('click', () => this.show());\n        if (show) {\n            setTimeout(() => this.show(), 0);\n        }\n\n        this.container.addEventListener('keydown', e => {\n            if ('Enter' === e.key || 13 === e.which || 13 === e.keyCode) {\n                this.applyFilter();\n                return false;\n            }\n\n            return true;\n        }, { capture: true });\n    }\n\n    get field() {\n        return this._field ? this._field.name : '';\n    }\n\n    set field(field: string) {\n        const fieldObject = this.fields.find(f => f.name === field);\n        if (! fieldObject) {\n            return;\n        }\n\n        this._field = fieldObject;\n        this.fieldSelect.value = fieldObject.name;\n        this._initFilter();\n    }\n\n    get operator(): [string, string] {\n        return this._operator ? this._operator() : [ 'eq', this.locale['is equal to'] ];\n    }\n\n    set operator(op: [string, string]) {\n        if (this.operatorSelect) {\n            this.operatorSelect.value = op[0];\n        }\n\n        this._operator = () => op;\n    }\n\n    get value(): any {\n        return this.other ? this.other() : null;\n    }\n\n    set value(value: any) {\n        if (this.otherInput) {\n            this.otherInput.value = value;\n        }\n\n        this.other = () => value;\n    }\n\n    private createTextFilter() {\n        const operatorSelect = this.operatorSelect = this.specContainer.appendChild(document.createElement('select'));\n        for (const op of TEXT_OPERATORS) {\n            const option = document.createElement('option');\n            option.value = op[0];\n            option.innerText = this.locale[op[1]] ?? op[1];\n\n            operatorSelect.appendChild(option);\n        }\n\n        const comparandInput = this.otherInput = this.specContainer.appendChild(document.createElement('input'));\n        comparandInput.type = 'text';\n        comparandInput.value = '';\n\n        operatorSelect.addEventListener('change', e => {\n            const operator = (e.target as HTMLSelectElement).value;\n            comparandInput.style.display = 'null' === operator || 'notnull' === operator ? 'none' : 'block';\n        });\n\n        this._operator = () => {\n            const value = operatorSelect.value;\n            return TEXT_OPERATORS.find(o => o[0] === value) as [string, keyof Localization];\n        };\n\n        this.other = () => comparandInput.value;\n    }\n\n    private createNumberFilter(type: FieldType.NUMBER | FieldType.DATE | FieldType.TIME) {\n        const operatorSelect = this.operatorSelect = this.specContainer.appendChild(document.createElement('select'));\n        for (const op of NUMBER_OPERATORS) {\n            const option = document.createElement('option');\n            option.value = op[0];\n            option.innerText = this.locale[op[1]] ?? op[1];\n\n            operatorSelect.appendChild(option);\n        }\n\n        const comparandInput = this.otherInput = this.specContainer.appendChild(document.createElement('input'));\n        comparandInput.value = '';\n        if (FieldType.NUMBER === type) {\n            comparandInput.type = 'number';\n        } else if (FieldType.DATE === type) {\n            comparandInput.type = 'date';\n        } else {\n            comparandInput.type = 'time';\n        }\n\n        operatorSelect.addEventListener('change', e => {\n            const operator = (e.target as HTMLSelectElement).value;\n            comparandInput.style.display = 'null' === operator || 'notnull' === operator ? 'none' : 'block';\n        });\n\n        this._operator = () => {\n            const value = operatorSelect.value;\n            return NUMBER_OPERATORS.find(o => o[0] === value) as [string, keyof Localization];\n        };\n\n        this.other = () => comparandInput.value;\n    }\n\n    private createBooleanFilter() {\n        const comparandSelect = this.otherInput = this.specContainer.appendChild(document.createElement('select'));\n        const values: [string, keyof Localization][] = [\n            [ '1', 'Yes' ],\n            [ '0', 'No' ],\n        ];\n\n        for (const op of values) {\n            const option = document.createElement('option');\n            option.value = op[0];\n            option.innerText = this.locale[op[1]] ?? op[1];\n\n            comparandSelect.appendChild(option);\n        }\n\n        this._operator = () => [ 'eq', 'is equal to' ];\n        this.other = () => comparandSelect.value;\n    }\n\n    private createChoiceFilter() {\n        const comparandSelect = this.otherInput = this.specContainer.appendChild(document.createElement('select'));\n        let choices: unknown = this._field?.choices ?? [];\n\n        const loadChoices = (choices: Choice[] | IterableIterator<Choice>) => {\n            comparandSelect.innerHTML = '';\n\n            for (const choice of choices) {\n                const option = document.createElement('option');\n                option.value = choice.value\n                option.innerText = choice.label;\n\n                comparandSelect.appendChild(option);\n            }\n        };\n\n        if ('function' === typeof choices) {\n            choices = choices() as (Choices | Promise<Choices>);\n        }\n\n        if ('then' in (choices as Choices | Promise<Choices>)) {\n            const loadingOption = document.createElement('option');\n            loadingOption.value = '';\n            loadingOption.innerText = this.locale['loading'];\n            comparandSelect.appendChild(loadingOption);\n\n            (choices as Promise<IterableIterator<Choice>>).then(loadChoices, () => {\n                loadingOption.innerText = this.locale['error while loading options'];\n            });\n        } else {\n            loadChoices(choices as Choices);\n        }\n\n        this._operator = () => [ 'eq', 'is equal to' ];\n        this.other = () => comparandSelect.value;\n    }\n\n    private _initFilter() {\n        const field = this._field;\n        if (! field) {\n            return;\n        }\n\n        this.specContainer.innerHTML = '';\n        this.operatorSelect = null;\n        this.otherInput = null;\n        switch (field.type) {\n            case FieldType.TEXT:\n                this.createTextFilter();\n                break;\n\n            case FieldType.NUMBER:\n            case FieldType.DATE:\n            case FieldType.TIME:\n                this.createNumberFilter(field.type);\n                break;\n\n            case FieldType.BOOLEAN:\n                this.createBooleanFilter();\n                break;\n\n            case FieldType.CHOICE:\n                this.createChoiceFilter();\n                break;\n        }\n    }\n\n    /**\n     * @internal\n     */\n    applyFilter() {\n        if (! this._operator || ! this.other || ! this._field) {\n            return;\n        }\n\n        const operator = this._operator();\n        const other = this.other();\n\n        this.label.innerText = (this._field.label ?? this._field.name) + ' ' + this.locale[operator[1] as keyof Localization];\n        if ('null' !== operator[0] && 'notnull' !== operator[0]) {\n            this.label.innerText += ' \"' + other + '\"';\n        }\n\n        this.hide();\n        this.dispatchEvent(new CustomEvent('apply-filter', {\n            detail: {\n                filter: this,\n                value: {\n                    field: this._field.name,\n                    operator: operator[0],\n                    value: other,\n                },\n            },\n        }))\n    }\n}\n","import '../styles/factes-js.scss';\nimport { Field, FieldProps } from './Field';\nimport EventTarget from 'event-target-shim';\nimport { FieldType } from './FieldType';\nimport { Filter } from './filter/Filter';\nimport { FilterInterface } from './filter/FilterInterface';\nimport { Localization } from './i18n/localization';\nimport { createButton } from './util';\nimport { en } from './i18n/en';\n\ntype DropdownElement = { label: string, filter: FilterInterface };\ninterface FacetsOptions {\n    classPrefix: string;\n    fields: FieldProps[];\n    locale: Localization;\n    dropdownLoader: (value: string, instance: Facets) => Generator<DropdownElement> | IterableIterator<DropdownElement> | DropdownElement[];\n}\n\nconst DEFAULT_OPTIONS: Omit<FacetsOptions, 'fields'> = {\n    classPrefix: '',\n    locale: en,\n    dropdownLoader: function * (value, instance): Generator<DropdownElement> {\n        const textFields = instance.fields.filter(f => f.type === FieldType.TEXT);\n        for (const field of textFields) {\n            yield {\n                label: field.label + ' ' + instance.locale['contains'] + ' \"' + value + '\"',\n                filter: {\n                    field: field.name,\n                    operator: [ 'ct', instance.locale['contains'] ],\n                    value,\n                },\n            };\n        }\n    },\n};\n\nfunction isKeyboardEvent(e: Event): e is KeyboardEvent {\n    return 'key' in e || 'which' in e || 'keyCode' in e;\n}\n\nexport class Facets extends EventTarget {\n    readonly fields: Readonly<Field[]> = [];\n    readonly locale: Localization;\n\n    private readonly options: FacetsOptions;\n    private readonly inputBox: HTMLInputElement;\n    private readonly newFilterBtn: HTMLButtonElement;\n    private readonly filters: Filter[] = [];\n    private readonly _appliedFilters = new Set<FilterInterface>();\n    private readonly dropdown: HTMLDivElement;\n    private dropdownSelected: number = -1;\n\n    constructor(private element: HTMLDivElement, options: Partial<FacetsOptions> = {}) {\n        super();\n        if ('DIV' !== element.tagName) {\n            throw new TypeError('Facets.js only supports div tags');\n        }\n\n        if (! options.fields || ! Array.isArray(options.fields) || 0 === options.fields.length) {\n            throw new Error('At least one field is required');\n        }\n\n        this.options = Object.assign({}, options, DEFAULT_OPTIONS) as FacetsOptions;\n        if (this.options.classPrefix) {\n            this.options.classPrefix += '-';\n        }\n\n        this.locale = this.options.locale;\n        this.fields = Object.freeze(options.fields.map(f => new Field(f)));\n\n        this.element.innerHTML = '';\n        this.element.classList.add(this.options.classPrefix + 'facets-js-wrapper');\n        this.element.style.display = 'flex';\n        this.element.style.flexWrap = '1';\n\n        // @todo: add default filters\n\n        const newFilterBtn = createButton('new-filter-btn', 'Add filter', 'plus');\n        this.newFilterBtn = this.element.appendChild(newFilterBtn);\n        this.newFilterBtn.addEventListener('click', () => this.createFilter());\n\n        const inputBox = document.createElement('input');\n        inputBox.type = 'text';\n        inputBox.style.minWidth = '10rem';\n        inputBox.style.flexGrow = '1';\n        inputBox.style.border = '0';\n        this.inputBox = this.element.appendChild(inputBox);\n\n        this.inputBox.addEventListener('input', this.onInput.bind(this));\n        this.inputBox.addEventListener('keydown', this.onInput.bind(this));\n        this.inputBox.addEventListener('keypress', this.onInput.bind(this));\n        this.inputBox.addEventListener('click', this.onInput.bind(this));\n\n        this.dropdown = this.element.appendChild(document.createElement('div'));\n        this.dropdown.classList.add('facets-js-dropdown', 'facets-js-hide');\n    }\n\n    get appliedFilters() {\n        return [ ...this._appliedFilters.values() ];\n    }\n\n    private onInput(e: KeyboardEvent | MouseEvent | Event): void {\n        const value = (e.target as HTMLInputElement).value;\n        if (! value) {\n            this.dropdown.classList.add('facets-js-hide');\n            return;\n        }\n\n        const rect = this.inputBox.getBoundingClientRect();\n        const choices = [];\n        for (const choice of this.options.dropdownLoader(value, this)) {\n            choices.push(choice);\n        }\n\n        const applyFilter = (choice: DropdownElement) => {\n            const choiceFilter = choice.filter;\n            const filter = this.createFilter(false);\n\n            filter.field = choiceFilter.field;\n            filter.operator = choiceFilter.operator;\n            filter.value = choiceFilter.value;\n\n            this.filters.push(filter);\n            filter.applyFilter();\n\n            this.dropdown.classList.add('facets-js-hide');\n            this.inputBox.value = '';\n        };\n\n        if (isKeyboardEvent(e)) {\n            if ('Enter' === e.key || 13 === e.which || 13 === e.keyCode) {\n                if (-1 !== this.dropdownSelected) {\n                    applyFilter(choices[this.dropdownSelected]);\n                } else if (this.inputBox.value !== '') {\n                    this.dropdown.classList.remove('facets-js-hide');\n                }\n\n                return;\n            } else if ('ArrowUp' === e.key || 38 === e.which || 38 === e.keyCode) {\n                if (-1 === this.dropdownSelected || 0 === this.dropdownSelected) {\n                    this.dropdownSelected = this.dropdown.children.length - 1;\n                } else {\n                    this.dropdownSelected--;\n                }\n\n                Array.prototype.slice.call(this.dropdown.children).forEach(e => e.classList.remove('selected'));\n                this.dropdown.children[this.dropdownSelected].classList.add('selected');\n                return;\n            } else if ('ArrowDown' === e.key || 40 === e.which || 40 === e.keyCode) {\n                if (-1 === this.dropdownSelected || this.dropdown.children.length - 1 === this.dropdownSelected) {\n                    this.dropdownSelected = 0;\n                } else {\n                    this.dropdownSelected++;\n                }\n\n                Array.prototype.slice.call(this.dropdown.children).forEach(e => e.classList.remove('selected'));\n                this.dropdown.children[this.dropdownSelected].classList.add('selected');\n                return;\n            } else if ('Escape' === e.key || 27 === e.which || 27 === e.keyCode) {\n                this.dropdownSelected = -1;\n                this.dropdown.classList.add('facets-js-hide');\n\n                return;\n            }\n        }\n\n        this.dropdown.innerHTML = '';\n        this.dropdown.classList.remove('facets-js-hide');\n        this.dropdown.style.width = rect.width.toString() + 'px';\n        this.dropdown.style.overflowY = 'scroll';\n        this.dropdown.style.top = (rect.bottom + 5).toString() + 'px';\n        this.dropdown.style.left = rect.left.toString() + 'px';\n\n        const listener = (e: MouseEvent) => {\n            let el: null | HTMLElement | (Node & ParentNode) = e.target as HTMLElement;\n            do {\n                if (el === this.inputBox || el === this.dropdown) {\n                    return;\n                }\n\n                el = el.parentElement || el.parentNode;\n            } while(null !== el && 1 === el.nodeType)\n\n            this.dropdownSelected = -1;\n            document.removeEventListener('click', listener);\n            this.dropdown.classList.add('facets-js-hide');\n        };\n\n        let index = -1;\n        let height = 0;\n\n        document.addEventListener('click', listener, { capture: true });\n\n        for (const choice of choices) {\n            const currentIndex = ++index;\n            const choiceElement = this.dropdown.appendChild(document.createElement('div'));\n            choiceElement.classList.add('facets-js-combo-choice');\n            choiceElement.innerText = choice.label;\n\n            const hover = () => {\n                Array.prototype.slice.call(this.dropdown.children).forEach(e => e.classList.remove('selected'));\n\n                this.dropdownSelected = currentIndex;\n                choiceElement.classList.add('selected');\n            };\n\n            choiceElement.addEventListener('mouseover', hover);\n            choiceElement.addEventListener('mouseenter', hover);\n            choiceElement.addEventListener('mouseout', () => {\n                if (this.dropdownSelected === currentIndex) {\n                    this.dropdownSelected = -1;\n                }\n\n                choiceElement.classList.remove('selected');\n            });\n\n            choiceElement.addEventListener('click', applyFilter.bind(this, choice));\n\n            const rect = choiceElement.getBoundingClientRect();\n            height += rect.height;\n        }\n\n        this.dropdown.style.height = height.toString() + 'px';\n    }\n\n    private createFilter(show = true) {\n        const filter = new Filter(\n            this.fields,\n            (element: HTMLElement) => this.element.insertBefore(element, this.newFilterBtn),\n            this.locale,\n            show\n        );\n\n        this.filters.push(filter);\n        this.newFilterBtn.style.display = 'none';\n\n        filter.addEventListener('remove', () => {\n            this.element.removeChild(filter.container);\n            this.filters.splice(this.filters.indexOf(filter), 1);\n            this.newFilterBtn.style.display = 'block';\n            this._appliedFilters.delete(filter);\n        }, { once: true });\n\n        filter.addEventListener('open', () => {\n            this.newFilterBtn.style.display = 'none';\n        });\n\n        filter.addEventListener('apply-filter', (e: Event) => {\n            this.newFilterBtn.style.display = 'block';\n            const { filter } = (e as CustomEvent).detail;\n            this._appliedFilters.add(filter);\n\n            this.dispatchEvent(new CustomEvent('change', {\n                detail: this.appliedFilters,\n            }));\n        });\n\n        return filter;\n    }\n}\n"],"names":[],"mappings":"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"}